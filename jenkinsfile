pipeline {

    parameters { 
        string defaultValue: 'main', name: 'branch', trim: true
        string defaultValue: 'maino', name: 'branchu', trim: true
     }

    environment {
         Myname = "Mohan"
         my_branch = "$branch"
    }

	agent none  
	stages {
		stage('BUILD') {
			parallel {
				stage('test on build') {

					
				
					agent { label 'slave2' }

					when {
						branch = Mohan
					}
			    		steps {
				   		 sh '''
						 pwd
						 sleep 5
					     echo "This is the fist stage: BUILD $my_branch $branchu"
				         '''
						}
                }
				
				
		
		
				stage('TEST on build 2') {
					agent { label 'master' }
					when {
						branchu = moni
					}
			    		steps {
				    		sh '''
					    	pwd
					   		sleep 5
					    	echo "this is the second stage: TEST $Myname $my_branch"
				        	'''
						}	
			    }
			}		
		}
		
		stage('TEST') {
					
					agent { label 'master' }
			    		steps {
							catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
				    			sh '''
					    		pwd
					   			sleep 5
					    		echo "this is the second stage: TEST $Myname $my_branch"
								exit 1
				        		'''
							}	
						}	
		}


		stage('DEPLOY') {
			 
			agent { label 'slave1' }
			steps {
				
					sh '''
					pwd
					sleep 5
					echo "This is the fist stage: DEPLOY $my_branch"
					
					'''
				}	
				
		}
	}
}